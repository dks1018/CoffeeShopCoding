import sys
import r2pipe

r2 = r2pipe.open("./lab4")
r2.cmd("e dbg.profile=lab4.rr2")
r2.cmd("doo")  # reopen in debug mode
r2.cmd("aaaa")
r2.cmd("db (frist break number)")  # sets the break point
r2.cmd("dc")  # Continue


def step():
    r2.cmd("ds")  # single step
    r2.cmd("sr rip")  # seek to the current RIP the value at RIP

    while true:
        disass = []
        while true:
            step()
            current_instruction = r2.cmdj("pdj 1")[0]
            disass.append(current_instruction['opcode'])
            if current_instruction['type'] == 'cjmp':
                break

            while True:
                step()
                if "loop" in r2.cmd("pdj 1")[0]['opcode']
                break
            target = hex(r2.cmdj("pdj 2")[1]['jump'])
            r2.cmd("dc")
